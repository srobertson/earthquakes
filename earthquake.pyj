earthquakes = rule('http://earthquake.usgs.gov/earthquakes/catalogs/eqs7day-M1.txt', 'earthquakes')
earthquakes.freq = MINUTELY
earthquakes.interval = 2


#earthquakes._partitions=1

@earthquakes.map
def map(line, params):
  if hasattr(params, 'keys'):
    params.keys = line.split(',')
  else:
    values = line.split(',')
    yield '', dict(zip(params.keys,values))
  
@earthquakes.reduce
def reduce(iter,params):
  for k,v in iter:
    yield k,v
